<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人知识库管理系统</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
</head>
<body>
<div id="app">
    <!-- 顶部导航 -->
    <header class="header">
        <div class="nav-brand">
            <h1>📚 个人知识库</h1>
        </div>
        <nav class="nav-menu">
            <a href="#dashboard" class="nav-item active">仪表盘</a>
            <a href="#documents" class="nav-item">文档管理</a>
            <a href="#categories" class="nav-item">分类管理</a>
            <a href="#tags" class="nav-item">标签管理</a>
            <a href="#search" class="nav-item">搜索</a>
            <a href="#knowledge-graph" class="nav-item">知识图谱</a>
            <a href="#recycle-bin" class="nav-item" id="recycle-bin-link">
                回收站
                <span id="recycle-bin-badge" class="recycle-bin-badge" style="display: none;"></span>
            </a>
            <a href="#favorites" class="nav-item" id="favorites-link">
                我的收藏
                <span id="favorites-badge" class="favorites-badge" style="display: none;"></span>
            </a>
        </nav>
        <div class="nav-user">
            <span id="username">用户</span>
            <div class="user-menu">
                <button onclick="showChangePasswordModal()" class="user-menu-btn">修改密码</button>
                <button onclick="logout()" class="logout-btn">退出</button>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="main-content">
        <!-- 仪表盘页面 -->
        <div id="dashboard-page" class="page active">
            <!-- 添加仪表盘工具栏 -->
            <div class="dashboard-toolbar">
                <div class="toolbar-left">
                    <h2>📊 仪表盘概览</h2>
                    <div class="last-updated">
                        <span>最后更新: </span>
                        <span id="last-loaded-time">尚未加载</span>
                    </div>
                </div>
                <div class="toolbar-right">
                    <div class="auto-refresh-toggle">
                        <label class="switch">
                            <input type="checkbox" id="auto-refresh-toggle">
                            <span class="slider"></span>
                        </label>
                        <span>自动刷新</span>
                    </div>
                    <button id="refresh-dashboard" class="btn-refresh">
                        <span class="refresh-icon">🔄</span> 刷新数据
                    </button>
                    <button id="export-dashboard" class="btn-secondary">
                        <span class="export-icon">📥</span> 导出数据
                    </button>
                </div>
            </div>

            <!-- 消息容器 -->
            <div id="dashboard-message" class="message-container"></div>

            <div class="stats-cards">
                <!-- 保持原有的统计卡片不变 -->
                <div class="stat-card">
                    <h3>
                        <span>📄</span> 总文档数
                        <span class="stat-icon">📈</span>
                    </h3>
                    <div id="total-documents" class="stat-number">0</div>
                    <div class="stat-change positive">+0</div>
                </div>
                <div class="stat-card">
                    <h3>
                        <span>📅</span> 今日新增
                        <span class="stat-icon">⚡</span>
                    </h3>
                    <div id="today-documents" class="stat-number">0</div>
                    <div class="stat-change positive">+0</div>
                </div>
                <div class="stat-card">
                    <h3>
                        <span>📁</span> 分类数量
                        <span class="stat-icon">📂</span>
                    </h3>
                    <div id="total-categories" class="stat-number">0</div>
                    <div class="stat-change positive">+0</div>
                </div>
                <div class="stat-card">
                    <h3>
                        <span>🏷️</span> 标签数量
                        <span class="stat-icon">🔖</span>
                    </h3>
                    <div id="total-tags" class="stat-number">0</div>
                    <div class="stat-change positive">+0</div>
                </div>
            </div>

            <div class="dashboard-content">
                <div class="recent-docs">
                    <h3>📝 最近文档</h3>
                    <div id="recent-docs-list" class="doc-list">
                        <div class="empty-state">
                            <div class="empty-icon">📄</div>
                            <div class="empty-text">暂无最近文档</div>
                            <div class="empty-hint">创建文档后，会在这里显示</div>
                        </div>
                    </div>
                </div>
                <div class="activity-log">
                    <h3>📋 最近活动</h3>
                    <div id="activity-list" class="activity-list">
                        <div class="empty-state">
                            <div class="empty-icon">📊</div>
                            <div class="empty-text">暂无活动记录</div>
                            <div class="empty-hint">操作文档后，会在这里显示</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文档管理页面 -->
        <div id="documents-page" class="page">
            <div class="page-header">
                <h2>文档管理</h2>
                <button onclick="showCreateDocumentModal()" class="btn-primary">新建文档</button>
            </div>
            <div class="toolbar">
                <select id="category-filter" class="filter-select">
                    <option value="">全部分类</option>
                </select>
            </div>
            <div id="documents-list" class="documents-grid"></div>
        </div>

        <!-- 分类管理页面 -->
        <div id="categories-page" class="page">
            <div class="page-header">
                <h2>分类管理</h2>
                <button onclick="showCreateCategoryModal()" class="btn-primary">新建分类</button>
            </div>
            <div id="category-tree" class="category-tree"></div>
        </div>

        <!-- 搜索页面 -->
        <div id="search-page" class="page">
            <div class="search-header">
                <div class="search-input-container">
                    <input type="text" id="global-search" placeholder="输入关键词搜索..." class="search-input-large">
                    <button onclick="app.performSearch()" class="btn-primary">搜索</button>
                </div>
            </div>

            <!-- 搜索状态显示区域 -->
            <div class="search-status" id="search-status" style="display: none;">
                <div class="status-info">
                    <span id="current-filters"></span>
                    <button onclick="app.clearSearchFilters()" class="btn-small btn-secondary">清除筛选</button>
                </div>
            </div>

            <div class="search-filters">
                <select id="search-category" class="filter-select">
                    <option value="">全部分类</option>
                </select>
                <select id="search-tag" class="filter-select">
                    <option value="">全部标签</option>
                </select>
                <button onclick="app.clearSearchFilters()" class="btn-secondary">清除筛选</button>
            </div>

            <div id="search-history" class="search-history-container"></div>

            <div id="search-results" class="search-results"></div>
        </div>

        <!-- 标签管理页面 -->
        <div id="tags-page" class="page">
            <div class="page-header">
                <h2>标签管理</h2>
                <button onclick="showCreateTagModal()" class="btn-primary">新建标签</button>
            </div>

            <div class="toolbar">
                <input type="text" id="tag-search" placeholder="搜索标签..." class="search-input">
                <select id="tag-sort" class="filter-select">
                    <option value="name">按名称排序</option>
                    <option value="count">按文档数量排序</option>
                    <option value="created">按创建时间排序</option>
                </select>
            </div>

            <div id="tags-container" class="tags-container">
                <div id="tags-list" class="tags-list"></div>
            </div>
        </div>

        <!-- 知识图谱页面 -->
        <div id="knowledge-graph-page" class="page">
            <div class="page-header">
                <h2>知识图谱</h2>
                <div class="graph-controls">
                    <button onclick="window.knowledgeGraphManager.rebuildGraph()" class="btn-secondary">重建图谱</button>
                    <button onclick="window.knowledgeGraphManager.exportGraph()" class="btn-secondary">导出图谱</button>
                </div>
            </div>

            <div class="graph-toolbar">
                <div class="graph-filters">
                    <select id="graph-type" class="filter-select" onchange="window.knowledgeGraphManager.changeGraphType()">
                        <option value="full">全量图谱</option>
                        <option value="documents">文档关系</option>
                        <option value="tags">标签云</option>
                        <option value="learning">学习路径</option>
                    </select>
                    <select id="graph-layout" class="filter-select" onchange="window.knowledgeGraphManager.changeLayout()">
                        <option value="force">力导向布局</option>
                        <option value="circular">环形布局</option>
                        <option value="grid">网格布局</option>
                    </select>
                    <input type="text" id="graph-search" placeholder="搜索节点..." class="search-input"
                           oninput="window.knowledgeGraphManager.searchNodes(this.value)">
                </div>
                <div class="graph-stats">
                    <span id="node-count">节点: 0</span>
                    <span id="link-count">关系: 0</span>
                </div>
            </div>

            <div class="graph-container">
                <div class="graph-main">
                    <div id="knowledge-graph" class="knowledge-graph"></div>
                </div>
                <div class="graph-sidebar">
                    <div class="sidebar-section">
                        <h4>节点详情</h4>
                        <div id="node-details" class="node-details">
                            <div class="no-selection">点击图谱中的节点查看详情</div>
                        </div>
                    </div>
                    <div class="sidebar-section">
                        <h4>图谱分析</h4>
                        <div id="graph-analysis" class="graph-analysis">
                            <div class="analysis-item">
                                <span class="label">中心节点:</span>
                                <span id="central-nodes" class="value">-</span>
                            </div>
                            <div class="analysis-item">
                                <span class="label">关联密度:</span>
                                <span id="relation-density" class="value">-</span>
                            </div>
                            <div class="analysis-item">
                                <span class="label">知识聚类:</span>
                                <span id="knowledge-clusters" class="value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 收藏页面 -->
        <div id="favorites-page" class="page">
            <div class="page-header">
                <h2>
                    <span class="favorite-icon">❤️</span>
                    我的收藏
                </h2>
                <div class="header-actions">
                    <button class="btn-secondary btn-refresh-favorites">刷新</button>
                </div>
            </div>

            <div class="filters-toolbar">
                <select id="favorites-category-filter" class="filter-select">
                    <option value="">全部分类</option>
                </select>
                <select id="favorites-tag-filter" class="filter-select">
                    <option value="">全部标签</option>
                </select>
                <input type="text" id="favorites-search" placeholder="在收藏中搜索..." class="search-input">
            </div>

            <div id="favorites-content" class="favorites-content">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>正在加载收藏文档...</p>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- 模态框容器 -->
<div id="modal-container"></div>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<!-- EasyMDE 编辑器库 -->
<script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
<script src="js/auth.js"></script>
<script src="js/app.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/document.js"></script>
<script src="js/category.js"></script>
<script src="js/tag.js"></script>
<script src="js/knowledge-graph.js"></script>
<script src="js/password.js"></script>
<script src="js/recycle-bin.js"></script>
<script src="js/favorite-manager.js"></script>

</body>
</html>